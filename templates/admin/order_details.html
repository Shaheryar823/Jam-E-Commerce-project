{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <div class="d-flex justify-content-between">
        <h2>Order #{{ order.id }}</h2>

        <a href="{{ url_for('admin.view_orders') }}" class="btn btn-secondary">
            Back
        </a>
    </div>

    <hr>

    <h4>Customer Information</h4>
    <ul>
        <li><strong>Name:</strong> {{ order.user.name }}</li>
        <li><strong>Email:</strong> {{ order.user.email }}</li>
        <li><strong>Phone:</strong> {{ order.user.phone }}</li>
        <li><strong>Address:</strong> {{ order.user.address }}</li>
    </ul>

    <h4>Order Items</h4>
    <table class="table table-bordered mt-3">
        <thead class="table-light">
            <tr>
                <th>Product</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Subtotal</th>
            </tr>
        </thead>

        <tbody>
            {% for item in order['items'] %}
            <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.quantity }}</td>
                <td>Rs {{ item.price }}</td>
                <td>Rs {{ item.quantity * item.price }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h4 class="mt-4">Order Summary</h4>
    <p><strong>Total:</strong> Rs {{ order.total }}</p>
    <p><strong>Status:</strong> 
        <span class="badge bg-info">{{ order.status|capitalize }}</span>
    </p>

    <hr>

    <h4>Change Status</h4>

    <form method="POST" action="{{ url_for('admin.update_order_status', oid=order.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <select name="status" class="form-select" required>
            <option value="pending" {% if order.status == "pending" %}selected{% endif %}>Pending</option>
            <option value="shipped" {% if order.status == "shipped" %}selected{% endif %}>Shipped</option>
            <option value="delivered" {% if order.status == "delivered" %}selected{% endif %}>Delivered</option>
            <option value="cancelled" {% if order.status == "cancelled" %}selected{% endif %}>Cancelled</option>
        </select>

        <button class="btn btn-primary mt-3">Update</button>
    </form>

</div>

{% endblock %}
